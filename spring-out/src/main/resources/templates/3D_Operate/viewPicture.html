<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head >
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Vito - Responsive Bootstrap 4 Admin Dashboard Template</title>


  <!-- Favicon -->
  <link rel="shortcut icon" th:href="@{images/favicon.ico}"/>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" th:href="@{css/bootstrap.min.css}">
  <!-- Typography CSS -->
  <link rel="stylesheet" th:href="@{css/typography.css}">
  <!-- Style CSS -->
  <link rel="stylesheet" th:href="@{css/style.css}">
  <!-- Responsive CSS -->
  <link rel="stylesheet" th:href="@{css/responsive.css}">
</head>
<body>
<!-- loader Start -->
<div id="loading">
  <div id="loading-center">
  </div>
</div>
<!-- loader END -->
<!-- Wrapper Start -->
<div class="wrapper">
  <!-- Sidebar  -->
  <div th:replace="~{commons/commons::sidebar}"></div>
  <!-- TOP Nav Bar -->
  <div th:replace="~{commons/commons::topnavbar}"></div>
  <!-- TOP Nav Bar END -->
  <!-- Responsive Breadcrumb End-->
  <!-- Page Content  -->
  <div id="content-page" class="content-page">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div id="app">
            <canvas id="imageCanvas"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Wrapper END -->
<!-- Footer -->
<div th:replace="~{commons/commons::footer}"></div>
<!-- Footer END -->
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="js/vue.js"></script>
<script src="js/axios.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- Appear JavaScript -->
<script src="js/jquery.appear.js"></script>
<!-- Countdown JavaScript -->
<script src="js/countdown.min.js"></script>
<!-- Counterup JavaScript -->
<script src="js/waypoints.min.js"></script>
<script src="js/jquery.counterup.min.js"></script>
<!-- Wow JavaScript -->
<script src="js/wow.min.js"></script>
<!-- Apexcharts JavaScript -->
<script src="js/apexcharts.js"></script>
<!-- Slick JavaScript -->
<script src="js/slick.min.js"></script>
<!-- Select2 JavaScript -->
<script src="js/select2.min.js"></script>
<!-- Owl Carousel JavaScript -->
<script src="js/owl.carousel.min.js"></script>
<!-- Magnific Popup JavaScript -->
<script src="js/jquery.magnific-popup.min.js"></script>
<!-- Smooth Scrollbar JavaScript -->
<script src="js/smooth-scrollbar.js"></script>
<!-- lottie JavaScript -->
<script src="js/lottie.js"></script>
<!-- Chart Custom JavaScript -->
<script src="js/chart-custom.js"></script>
<!-- Custom JavaScript -->
<script src="js/custom.js"></script>


<script src="js/cornerstone/cornerstone.js"></script>
<script src="js/cornerstone/cornerstoneMath.js"></script>
<script src="js/cornerstone/cornerstoneTools.js"></script>
<script src="js/cornerstone/cornerstoneFileImageLoader.js"></script>
<script src="js/cornerstone/cornerstoneNIFTIImageLoader.js"></script>
<script>
  // app.js
  new Vue({
    el: '#app',
    mounted() {
      const imageCanvas = document.getElementById('imageCanvas');
      const cornerstone = window.cornerstone;
      const niftiReader = window.niftiReader;

      cornerstone.enable(imageCanvas);

      const apiURL = '/api/nifti'; // 替换为您的 API URL

      fetch(apiURL)
              .then(response => response.arrayBuffer())
              .then(arrayBuffer => {
                const nifti = niftiReader.read(arrayBuffer);

                const image = {
                  imageId: 'nifti:',
                  minPixelValue: nifti.minPixelValue,
                  maxPixelValue: nifti.maxPixelValue,
                  slope: 1,
                  intercept: 0,
                  windowCenter: (nifti.maxPixelValue - nifti.minPixelValue) / 2,
                  windowWidth: nifti.maxPixelValue - nifti.minPixelValue,
                  getPixelData: () => nifti.imageData,
                  rows: nifti.header.dims[1],
                  columns: nifti.header.dims[2],
                  height: nifti.header.dims[1],
                  width: nifti.header.dims[2],
                  color: 'red',
                  label: 'NIfTI Image'
                };

                const imageId = cornerstone.addLayer(imageCanvas, image);
                cornerstone.displayImage(imageCanvas, imageId);
              })
              .catch(error => {
                console.error(error);
              });
    }
  });

</script>

</body>
</html>