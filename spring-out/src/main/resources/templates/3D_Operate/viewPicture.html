<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Vito - Responsive Bootstrap 4 Admin Dashboard Template</title>


    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{images/favicon.ico}"/>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{css/bootstrap.min.css}">
    <!-- Typography CSS -->
    <link rel="stylesheet" th:href="@{css/typography.css}">
    <!-- Style CSS -->
    <link rel="stylesheet" th:href="@{css/style.css}">
    <!-- Responsive CSS -->
    <link rel="stylesheet" th:href="@{css/responsive.css}">
    <link rel="stylesheet" th:href="@{js/cornerstone/cornerstone.min.css}"/>
    <link rel="stylesheet" th:href="@{js/cornerstone/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{js/cornerstone/example.min.css}"/>
    <style>
        .image-view {
            width: 300px;
            height: 300px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
<!-- loader Start -->
<div id="loading">
    <div id="loading-center">
    </div>
</div>
<!-- loader END -->
<!-- Wrapper Start -->
<div class="wrapper">
    <!-- Sidebar  -->
    <div th:replace="~{commons/commons::sidebar}"></div>
    <!-- TOP Nav Bar -->
    <div th:replace="~{commons/commons::topnavbar}"></div>
    <!-- TOP Nav Bar END -->
    <!-- Responsive Breadcrumb End-->
    <!-- Page Content  -->

    <div id="content-page" class="content-page">
        <div class="container">
            <div class="row">
                <div class="col">
                    <form id="form">
                        <div class="form-group form-row">
                            <label class="col-form-label col-sm-1" for="nifti-URL">URL</label>
                            <div class="col-sm-7">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">nifti:</div>
                                    </div>
                                    <input class="form-control" type="text" id="nifti-URL" placeholder="Enter URL to NIFTI file or pick from list" >
                                </div>
                            </div>
                            <div class="col-sm-3">
                                <button class="btn btn-primary" type="button" id="download-and-view">Download and View</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div id="axial-view" class="image-view"></div>
                </div>
                <div class="col-md-4">
                    <div id="sagittal-view" class="image-view"></div>
                </div>
                <div class="col-md-4">
                    <div id="coronal-view" class="image-view"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Wrapper END -->
<!-- Footer -->
<div th:replace="~{commons/commons::footer}"></div>
<!-- Footer END -->
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="js/vue.js"></script>
<script src="js/axios.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- Appear JavaScript -->
<script src="js/jquery.appear.js"></script>
<!-- Countdown JavaScript -->
<script src="js/countdown.min.js"></script>
<!-- Counterup JavaScript -->
<script src="js/waypoints.min.js"></script>
<script src="js/jquery.counterup.min.js"></script>
<!-- Wow JavaScript -->
<script src="js/wow.min.js"></script>
<!-- Apexcharts JavaScript -->
<script src="js/apexcharts.js"></script>
<!-- Slick JavaScript -->
<script src="js/slick.min.js"></script>
<!-- Select2 JavaScript -->
<script src="js/select2.min.js"></script>
<!-- Owl Carousel JavaScript -->
<script src="js/owl.carousel.min.js"></script>
<!-- Magnific Popup JavaScript -->
<script src="js/jquery.magnific-popup.min.js"></script>
<!-- Smooth Scrollbar JavaScript -->
<script src="js/smooth-scrollbar.js"></script>
<!-- lottie JavaScript -->
<script src="js/lottie.js"></script>
<!-- Chart Custom JavaScript -->
<script src="js/chart-custom.js"></script>
<!-- Custom JavaScript -->
<script src="js/custom.js"></script>


<script src="js/cornerstone/cornerstone.js"></script>
<script src="js/cornerstone/cornerstoneMath.js"></script>
<script src="js/cornerstone/cornerstoneTools.js"></script>
<script src="js/cornerstone/cornerstoneFileImageLoader.js"></script>
<script src="js/cornerstone/cornerstoneNIFTIImageLoader.js"></script>
<script>
    // Get Cornerstone imageIds and fetch metadata into RAM
    const imageIds = await createImageIdsAndCacheMetaData({
        StudyInstanceUID:
            '1.3.6.1.4.1.14519.5.2.1.7009.2403.334240657131972136850343327463',
        SeriesInstanceUID:
            '1.3.6.1.4.1.14519.5.2.1.7009.2403.226151125820845824875394858561',
        wadoRsRoot: 'https://d3t6nz73ql33tx.cloudfront.net/dicomweb',
    });

    const content = document.getElementById('content');

    const viewportGrid = document.createElement('div');
    viewportGrid.style.display = 'flex';
    viewportGrid.style.flexDirection = 'row';

    // element for axial view
    const element1 = document.createElement('div');
    element1.style.width = '500px';
    element1.style.height = '500px';

    // element for sagittal view
    const element2 = document.createElement('div');
    element2.style.width = '500px';
    element2.style.height = '500px';

    viewportGrid.appendChild(element1);
    viewportGrid.appendChild(element2);

    content.appendChild(viewportGrid);

    const renderingEngineId = 'myRenderingEngine';
    const renderingEngine = new RenderingEngine(renderingEngineId);

    // note we need to add the cornerstoneStreamingImageVolume: to
    // use the streaming volume loader
    const volumeId = 'cornerstoneStreamingImageVolume: myVolume';

    // Define a volume in memory
    const volume = await volumeLoader.createAndCacheVolume(volumeId, {
        imageIds,
    });

    const viewportId1 = 'CT_AXIAL';
    const viewportId2 = 'CT_SAGITTAL';

    const viewportInput = [
        {
            viewportId: viewportId1,
            element: element1,
            type: ViewportType.ORTHOGRAPHIC,
            defaultOptions: {
                orientation: Enums.OrientationAxis.AXIAL,
            },
        },
        {
            viewportId: viewportId2,
            element: element2,
            type: ViewportType.ORTHOGRAPHIC,
            defaultOptions: {
                orientation: Enums.OrientationAxis.SAGITTAL,
            },
        },
    ];

    renderingEngine.setViewports(viewportInput);

    // Set the volume to load
    volume.load();

    setVolumesForViewports(
        renderingEngine,
        [{ volumeId }],
        [viewportId1, viewportId2]
    );

    // Render the image
    renderingEngine.renderViewports([viewportId1, viewportId2]);
</script>
</body>
</html>